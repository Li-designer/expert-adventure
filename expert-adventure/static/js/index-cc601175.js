import{g as F,a as S,e as q,b as M}from"./role-03104db1.js";import{ae as Q}from"./index-fff9eaea.js";import{aX as W}from"./index-13eaa06f.js";import{m as g}from"./message-21a4cbe2.js";import{Q as X}from"./index-2c55bd39.js";import{q as N,r as c,U as G,w as H,a6 as r,t as Y,v as Z,L as t,E as a,J as i,u as E,x as ee}from"./runtime-core.esm-bundler-3932d34b.js";import"./vue-router-ff44b207.js";import"./index-65f2f33a.js";const le={class:"dialog-footer"},te=N({name:"permissionRole"}),me=N({...te,setup(oe){const w=c([]),p=c([]),_=c([]),v=c(""),m=c(),u=c(!1),d=c(null),y=c(""),C="80px",n=G({rolename:"",roleType:""}),I={children:"children",label:(l,e)=>l.meta.title};H(v,l=>{m.value.filter(l)});const O=(l,e)=>l?e.meta.title.includes(l):!0,R=async()=>{const{data:l}=await Q();p.value=l};R();const b=async()=>{const{data:l}=await F();w.value=l};b();const U=()=>{y.value="新增角色",u.value=!0},B=async()=>{if(d.value){const{data:l,success:e}=await q({roleId:d.value,...n});e&&(g("操作成功!",{type:"success"}),h(),b())}else{const{data:l,success:e}=await S({...n});e&&(g("操作成功!",{type:"success"}),h(),b())}},K=l=>{y.value="编辑角色";const e=JSON.parse(JSON.stringify(l));d.value=l.roleId,Object.keys(n).forEach(o=>{n[o]=e[o]}),u.value=!0},L=l=>{},h=()=>{const l={rolename:"",roleType:""};Object.keys(n).forEach(e=>{n[e]=l[e]}),u.value=!1,d.value=null},j=(l,e,o)=>{_.value=[],d.value=l.roleId;const f=V(p.value,l.roleType);m.value.setCheckedKeys(f)},V=(l,e)=>(l.forEach(o=>{o.meta.roles.indexOf(e)!==-1&&_.value.push(o.id),o.children&&o.children.length>0&&V(o.children,e)}),_.value),z=async()=>{const l=m.value.getCheckedKeys(),{success:e}=await M({roleId:d.value,keys:l});e&&(R(),d.value=null,m.value.setCheckedKeys(l),g("操作成功!",{type:"success"}))};return(l,e)=>{const o=r("el-button"),f=r("el-table-column"),A=r("el-table"),x=r("el-col"),k=r("el-input"),J=r("el-row"),T=r("el-form-item"),P=r("el-form"),$=r("el-dialog");return Y(),Z("div",null,[t(o,{onClick:U,size:"small",icon:E(W),style:{"margin-bottom":"10px"}},{default:a(()=>[i("新增角色")]),_:1},8,["icon"]),t(J,{style:{display:"flex","justify-content":"space-between"}},{default:a(()=>[t(x,{span:16},{default:a(()=>[t(A,{data:w.value,stripe:"","highlight-current-row":"",style:{width:"100%"},onRowClick:j},{default:a(()=>[t(f,{prop:"rolename",label:"角色名称","min-width":"180"}),t(f,{prop:"roleType",label:"角色标识","min-width":"180"}),t(f,{fixed:"right",label:"操作",width:"120"},{default:a(({row:s})=>[t(o,{link:"",type:"primary",size:"small",onClick:D=>K(s)},{default:a(()=>[i("编辑")]),_:2},1032,["onClick"]),t(o,{link:"",type:"danger",size:"small",onClick:D=>L(s)},{default:a(()=>[i("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),t(x,{span:7,style:{"background-color":"#fff",padding:"10px"}},{default:a(()=>[t(o,{color:"#366BF2",style:{"margin-bottom":"10px",float:"right"},onClick:z},{default:a(()=>[i("保存")]),_:1}),t(k,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),placeholder:""},null,8,["modelValue"]),t(E(X),{ref_key:"treeRef",ref:m,class:"filter-tree","show-checkbox":"","node-key":"id",data:p.value,props:I,"default-expand-all":"","filter-node-method":O},null,8,["data"])]),_:1})]),_:1}),t($,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=s=>u.value=s),title:y.value,width:"30%",onClose:h},{footer:a(()=>[ee("span",le,[t(o,{onClick:e[3]||(e[3]=s=>u.value=!1)},{default:a(()=>[i("取消")]),_:1}),t(o,{type:"primary",onClick:B},{default:a(()=>[i(" 确定 ")]),_:1})])]),default:a(()=>[t(P,{model:n},{default:a(()=>[t(T,{label:"角色名称","label-width":C},{default:a(()=>[t(k,{modelValue:n.rolename,"onUpdate:modelValue":e[1]||(e[1]=s=>n.rolename=s),autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(T,{label:"角色标识","label-width":C},{default:a(()=>[t(k,{modelValue:n.roleType,"onUpdate:modelValue":e[2]||(e[2]=s=>n.roleType=s),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{me as default};
